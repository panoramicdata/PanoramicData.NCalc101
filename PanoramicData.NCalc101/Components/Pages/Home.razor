@page "/"
@using PanoramicData.Blazor;
@using PanoramicData.Blazor.Models
@using PanoramicData.NCalc101.Models

<PageTitle>NCalc 101</PageTitle>
<div class="row">
	<div class="col-12">
		<PDToolbar>
			<PDToolbarTextbox Value="@WorkspaceService.Workspace.Name"
							  ValueChanged="NameChangedAsync"
							  Label="Workspace"
							  ShowClearButton="false"
							  />
			<PDToolbarDropdown Text="Add Variable"
							   IconCssClass="fa fa-plus"
							   CssClass="btn btn-success"
							   IsEnabled="true"
							   Click="@(async x => await AddVariableAsync(x))"
							   Items="_addVariableMenuItems">

			</PDToolbarDropdown>

			<PDToolbarButton Text="Delete Variable(s)"
							 IsEnabled="@(_table!.Selection is not null)"
							 IconCssClass="fa-solid fa-trash"
							 CssClass="btn btn-danger"
							 Click="DeleteRowAsync" />

			<PDToolbarButton Text="Create Workspace"
							 IconCssClass="fa-solid fa-plus"
							 CssClass="btn btn-success"
							 ShiftRight="true"
							 Click="CreateWorkspaceAsync" />

			<PDToolbarButton Text="Delete Workspace"
							 IsEnabled="@(WorkspaceService.Workspace.Name != "default")"
							 IconCssClass="fa-solid fa-trash"
							 CssClass="btn btn-danger"
							 ShiftRight="true"
							 Click="DeleteWorkspaceAsync" />
		</PDToolbar>
	</div>
</div>
<div class="row">
	<div class="col-lg-6">
		<h3><i class="fa-solid fa-keyboard" /> Input</h3>
		<PDTextArea Value="@WorkspaceService.Workspace.Expression" Rows="10" ValueChanged="OnExpressionChangedAsync" />
	</div>
	<div class="col-lg-6">
		@if (_exceptionMessage == string.Empty)
{
		<h3><i class="fa-solid fa-check-circle" /> Output (@_resultType)</h3>
		<PDTextArea @bind-Value="_result" Rows="10" CssClass="result" IsReadOnly="true" />
}
else
{
		<h3><i class="fa-solid fa-warning" /> Error</h3>
		<PDTextArea @bind-Value="_exceptionMessage" CssClass="result" IsReadOnly="true" />
}
	</div>
</div>
<div class="row mt-3">
	<div class="col-12">
		<h3><i class="fa-solid fa-list" /> Variables</h3>
		<PDTable
			TItem="Variable"
			@ref = "_table"
			DataProvider="WorkspaceService"
			CssClass="variable-table"
			AllowEdit="true"
			AfterEditCommitted="OnVariableChangedAsync"
			DoubleClick="OnDoubleClickRowAsync"
			UserSelectable="true"
			KeyField="v => v.Id"
			SelectionMode="TableSelectionMode.Multiple"
			ExceptionHandler="TableExceptionHandler"
		>
			<PDColumn TItem="Variable"
					  Id="Type"
					  Title="Type">
				<Template>
					<i class="@context.GetFontAwesome()" />
					@context.Type.ToString()
				</Template>
			</PDColumn>
			<PDColumn TItem="Variable"
					  Id="Id"
					  Title="Id"
					  ShowInList="false"
					  Editable="false" 
					  Field="v => v.Id" />
			<PDColumn TItem="Variable"
					  Id="Name"
					  Title="Name"
					  Editable="true"
					  Field="v => v.Name" />
			<PDColumn TItem="Variable"
					  Id="Value"
					  Title="Value"
					  Editable="true"
					  Field="v => v.Value" />
		</PDTable>
	</div>
</div>